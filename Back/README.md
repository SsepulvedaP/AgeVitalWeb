<h1 align="center">Sistema Backend del Proyecto AgeVital+</h1> <h3 align="center">Un proyecto en Flask para manejar registro, inicio de sesión, permisos de usuarios, almacenamiento de datos de sensores e interacción con los mismos.</h3> <h2>Índice</h2> <ul> <li><a href="#descripción">Descripción</a></li> <li><a href="#estructura-del-proyecto">Estructura del proyecto</a></li> <li><a href="#instrucciones-de-instalación">Instrucciones de instalación</a></li> <li><a href="#cómo-usar-el-proyecto">Cómo usar el proyecto</a></li> <li><a href="#tecnologías-usadas">Tecnologías usadas</a></li> </ul> <h2 id="descripción">Descripción</h2> <p>Este proyecto es un sistema backend desarrollado en Flask, diseñado para gestionar usuarios y manejar datos de sensores. Los usuarios pueden registrarse, iniciar sesión y tener diferentes permisos de acceso según sus roles (<code>admin</code> y <code>user</code>). El sistema también permite almacenar y recuperar datos de sensores ambientales como temperatura, humedad, ruido y calidad del aire en una base de datos, especialmente para monitorear las condiciones en la EcoVilla UPB.</p> <h2 id="estructura-del-proyecto">Estructura del proyecto</h2> <h3>app.py</h3> <p>Punto de entrada de la aplicación. Configura Flask, inicializa la base de datos y los módulos de autenticación y registra los blueprints para organizar las rutas. Carga configuraciones desde <code>config.py</code> y otros archivos de configuración específicos de la base de datos.</p> <h3>auth.py</h3> <p>Define las rutas de autenticación:</p> <ul> <li><strong>/register</strong>: Registra un nuevo usuario con un rol y una contraseña encriptada.</li> <li><strong>/login</strong>: Inicia sesión y genera un token de acceso JWT, ahora incluye el rol del usuario en el token.</li> <li><strong>/change_password</strong>: Permite a los administradores cambiar contraseñas.</li> <li><strong>/delete_user</strong>: Permite a los administradores eliminar usuarios de la base de datos.</li> </ul> <p>Utiliza <code>Flask-JWT-Extended</code> para tokens y <code>bcrypt</code> para encriptar contraseñas.</p> <h3>config.py y config_db_users.py</h3> <p>Estos archivos contienen la configuración de la aplicación:</p> <ul> <li><strong>config.py</strong>: Carga variables de entorno desde un archivo <code>.env</code> usando <code>python-dotenv</code>. Configura claves secretas y detalles de conexión a la base de datos.</li> <li><strong>config_db_users.py</strong>: Configuración específica de la base de datos de usuarios.</li> </ul> <h3>models.py</h3> <p>Define los modelos de la base de datos usando SQLAlchemy:</p> <ul> <li><strong>Role</strong>: Almacena los roles de usuario (<code>admin</code> y <code>user</code>).</li> <li><strong>User</strong>: Almacena la información de los usuarios (nombre de usuario, correo, contraseña y rol).</li> <li><strong>Sensores y Mediciones</strong>: Define los modelos relacionados con los datos de sensores y sus mediciones, incluyendo <code>Sensores</code>, <code>TipoMedicion</code>, y <code>Mediciones</code>.</li> </ul> <p>Cada modelo incluye métodos útiles, como <code>verify_password</code> para validar contraseñas.</p> <h3>routes.py</h3> <p>Define las rutas adicionales de la API para interactuar con los datos de sensores y obtener información de usuarios:</p> <ul> <li><strong>GET /users</strong>: Permite a los administradores listar todos los usuarios.</li> </ul> <h3>docker-compose.yml</h3> <p>Configura y orquesta los servicios necesarios. Define tres servicios:</p> <ul> <li><strong>db_usuarios</strong>: Servicio de base de datos PostgreSQL para usuarios, con persistencia de datos a través de volúmenes.</li> <li><strong>db_sensores</strong>: Servicio de base de datos PostgreSQL para datos de sensores, también con volúmenes.</li> <li><strong>web</strong>: Servicio Flask que construye y ejecuta la aplicación, exponiendo el puerto 5000.</li> </ul> <h3>Dockerfile</h3> <p>Define la imagen para el servicio web. Incluye la instalación de dependencias y configuración del entorno de Flask.</p> <h3>requirement.txt</h3> <p>Lista todas las dependencias necesarias para el proyecto:</p> <pre><code>Flask Flask-SQLAlchemy Flask-Migrate psycopg2 Flask-CORS Flask-Bcrypt Flask-JWT-Extended psycopg2-binary python-dotenv </code></pre> <p>Permite instalar todas las librerías con el comando <code>pip install -r requirement.txt</code>.</p> <h2 id="instrucciones-de-instalación">Instrucciones de instalación</h2> <ol> <li>Clona este repositorio.</li> <li>Crea un archivo <code>.env</code> en la raíz del proyecto y configura las variables de entorno necesarias para la base de datos y las claves secretas.</li> <li>Construye los contenedores Docker con: <pre><code>docker-compose build</code></pre> </li> <li>Para subir los contenedores, usa: <pre><code>docker-compose up -d</code></pre> </li> <li>Para detener los contenedores, usa: <pre><code>docker-compose down</code></pre> </li> </ol> <h2 id="cómo-usar-el-proyecto">Cómo usar el proyecto</h2> <ol> <li>Utiliza un cliente como Postman para probar las rutas:</li> <ul> <li><strong>POST /auth/register</strong>: Registra un nuevo usuario.</li> <li><strong>POST /auth/login</strong>: Inicia sesión y obtiene el token JWT. Incluye el rol en el token.</li> <li><strong>PUT /auth/change_password</strong>: Cambia la contraseña de un usuario (solo para administradores).</li> <li><strong>DELETE /auth/delete_user</strong>: Elimina un usuario de la base de datos (solo para administradores).</li> </ul> <li>Incluye el token JWT en el encabezado de autorización para acceder a las rutas protegidas.</li> <li>Para las operaciones relacionadas con sensores, usa las rutas definidas en <code>routes.py</code> (revisa las rutas en el archivo para conocer más detalles).</li> </ol> <h2 id="tecnologías-usadas">Tecnologías usadas</h2> <ul> <li><strong>Python</strong> y <strong>Flask</strong> para el backend.</li> <li><strong>PostgreSQL</strong> para la base de datos de usuarios y sensores.</li> <li><strong>Docker</strong> para contenerización y administración de servicios.</li> <li><strong>Fiware-Orion</strong> para la comunicación y gestión de datos de sensores.</li> </ul> <h2 align="center">Tecnologías utilizadas</h2> <div align="center"> <a href="https://www.postgresql.org/" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/postgresql/postgresql-original-wordmark.svg" alt="postgresql" width="40" height="40"/> </a> <a href="https://postman.com" target="_blank" rel="noreferrer"> <img src="https://www.vectorlogo.zone/logos/getpostman/getpostman-icon.svg" alt="postman" width="40" height="40"/> </a> <a href="https://www.python.org" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/python/python-original.svg" alt="python" width="40" height="40"/> </a> <a href="https://www.mongodb.com/" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/mongodb/mongodb-original-wordmark.svg" alt="mongodb" width="40" height="40"/> </a> </div>
